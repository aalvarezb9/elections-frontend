<mat-toolbar color="primary" class="mat-elevation-z4">
  <span>Administración nacional / centros</span>
</mat-toolbar>

<div class="admin-wrapper">
  <mat-accordion multi>

    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>Conexión y estado</mat-panel-title>
      </mat-expansion-panel-header>

      <div class="row">
        <mat-card class="card">
          <mat-card-content>
            <div *ngIf="!account" class="stack">
              <button mat-raised-button color="primary" (click)="connect()">
                <mat-icon>vpn_key</mat-icon> Conectar wallet
              </button>
            </div>
            <div *ngIf="account" class="stack">
              <span>Conectado:</span>
              <code class="mono">{{ account }}</code>
            </div>

            <mat-divider class="sp"></mat-divider>

            <div class="stack">
              <span>Elección actual: <span class="mono">{{ electionId || 'Ninguna' }}</span></span>
              <br>
              <button mat-stroked-button color="primary" (click)="syncRoot()">
                <mat-icon>sync</mat-icon> Sincronizar Merkle root desde RNP
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Candidatos</mat-panel-title>
      </mat-expansion-panel-header>

      <mat-card class="card">
        <mat-card-content>
          <div class="row gap">
            <mat-form-field appearance="outline" class="grow">
              <mat-label>Nombre de candidato</mat-label>
              <input matInput [(ngModel)]="newCandidate" placeholder="Ej. Ana Pérez" />
            </mat-form-field>

            <button mat-raised-button color="primary" (click)="addCandidate()">
              <mat-icon>person_add</mat-icon> Añadir
            </button>
            <button mat-button color="warn" (click)="clearCandidates()">
              <mat-icon>clear_all</mat-icon> Limpiar lista
            </button>
          </div>

          <div class="cand-list">
            <mat-card class="cand-item mat-elevation-z1" *ngFor="let c of candidates; trackBy: trackById">
              <div class="cand-head">
                <span class="chip">#{{ c.id }}</span>
                <span class="name">{{ c.name }}</span>
                <span class="votes">Votos: {{ c.voteCount }}</span>
              </div>

              <mat-form-field appearance="fill" class="full">
                <mat-label>Imagen URL</mat-label>
                <input matInput [(ngModel)]="images[c.id]" placeholder="https://..." />
                <mat-icon matSuffix>image</mat-icon>
              </mat-form-field>
            </mat-card>
          </div>

          <div class="end">
            <button mat-raised-button color="accent" (click)="saveImages()">
              <mat-icon>save</mat-icon> Guardar imágenes
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Iniciar elección</mat-panel-title>
      </mat-expansion-panel-header>

      <mat-card class="card">
        <mat-card-content>
          <div class="row gap">
            <mat-checkbox [(ngModel)]="replaceCandidates">
              Reemplazar con la lista (uno por línea)
            </mat-checkbox>
          </div>

          <mat-form-field appearance="outline" class="full">
            <mat-label>Listado de candidatos</mat-label>
            <textarea
              matInput rows="5"
              [(ngModel)]="newCandidatesMultiline"
              [disabled]="!replaceCandidates"
              placeholder="Ana Pérez&#10;Luis Gómez&#10;María Castro"
            ></textarea>
          </mat-form-field>

          <div class="end">
            <button mat-raised-button color="primary" (click)="startElection()">
              <mat-icon>rocket_launch</mat-icon> Iniciar elección
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </mat-expansion-panel>

    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Centros y mesas</mat-panel-title>
      </mat-expansion-panel-header>

      <mat-card class="card">
        <mat-card-content>

          <div class="row grid2">
            <mat-form-field appearance="outline">
              <mat-label>Center ID</mat-label>
              <input matInput type="number" [(ngModel)]="centerId" />
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Nombre</mat-label>
              <input matInput [(ngModel)]="centerName" />
            </mat-form-field>

            <div class="end-row">
              <button mat-raised-button color="primary" (click)="registerCenter()">
                <mat-icon>domain_add</mat-icon> Registrar centro
              </button>
            </div>
          </div>

          <mat-divider class="sp"></mat-divider>

          <div class="row grid1-2">
            <mat-form-field appearance="outline" class="full">
              <mat-label>Admin del centro (address)</mat-label>
              <input matInput [(ngModel)]="centerAdminAddr" />
            </mat-form-field>

            <div class="end-row">
              <button mat-stroked-button color="primary" (click)="setCenterAdmin()">
                <mat-icon>admin_panel_settings</mat-icon> Asignar admin del centro
              </button>
            </div>
          </div>

          <mat-divider class="sp"></mat-divider>

          <div class="row grid3">
            <mat-form-field appearance="outline">
              <mat-label>Mesa ID</mat-label>
              <input matInput type="number" [(ngModel)]="mesaId" />
            </mat-form-field>

            <div class="row actions-row">
              <button mat-button (click)="calcRoot()">
                <mat-icon>calculate</mat-icon> Calcular root (RNP)
              </button>
            </div>

            <mat-form-field appearance="fill" class="full">
              <mat-label>Merkle root</mat-label>
              <input matInput [(ngModel)]="root" placeholder="0x...64hex" />
            </mat-form-field>

            <div class="end-row">
              <button mat-raised-button color="accent" (click)="setRoot()">
                <mat-icon>task_alt</mat-icon> Fijar root
              </button>
            </div>
          </div>

          <mat-divider class="sp"></mat-divider>

          <div class="row gap">
            <button mat-raised-button color="primary" (click)="openCenter()">
              <mat-icon>play_arrow</mat-icon> Abrir centro
            </button>
            <button mat-raised-button color="warn" (click)="closeCenter()">
              <mat-icon>stop_circle</mat-icon> Cerrar centro
            </button>
          </div>

          <div *ngIf="status" class="status">
            {{ status }}
          </div>

        </mat-card-content>
      </mat-card>
    </mat-expansion-panel>

  </mat-accordion>
</div>
